name: FCM Test Notification

on:
  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
  workflow_dispatch:
    inputs:
      title:
        description: 'ì•Œë¦¼ ì œëª©'
        required: false
        default: 'ğŸ§ª í…ŒìŠ¤íŠ¸ ì•Œë¦¼'
      body:
        description: 'ì•Œë¦¼ ë‚´ìš©'
        required: false
        default: 'Firebase Functions ê¸°ë°˜ FCM ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤!'
      topic:
        description: 'FCM í† í”½'
        required: false
        default: 'daily-feed'

# GitHub Actions ê¶Œí•œ ì„¤ì •
permissions:
  contents: read

jobs:
  send-test-notification:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.23'

      - name: Cache Go modules
        uses: actions/cache@v3
        with:
          path: ~/go/pkg/mod
          key: ${{ runner.os }}-go-${{ hashFiles('backend/go.sum') }}
          restore-keys: |
            ${{ runner.os }}-go-

      - name: Send FCM Test Notification
        env:
          FIREBASE_PROJECT_ID: daily-feed-notifications
          FIREBASE_SERVICE_ACCOUNT_KEY: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_KEY }}
        working-directory: ./backend
        run: |
          echo "FCM í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë°œì†¡ ì‹œì‘..."
          echo "ì œëª©: ${{ github.event.inputs.title || 'ğŸ§ª í…ŒìŠ¤íŠ¸ ì•Œë¦¼' }}"
          echo "ë‚´ìš©: ${{ github.event.inputs.body || 'Firebase Functions ê¸°ë°˜ FCM ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤!' }}"
          echo "í† í”½: ${{ github.event.inputs.topic || 'daily-feed' }}"
          
          go run cmd/fcm-send/main.go \
            -topic "${{ github.event.inputs.topic || 'daily-feed' }}" \
            -title "${{ github.event.inputs.title || 'ğŸ§ª í…ŒìŠ¤íŠ¸ ì•Œë¦¼' }}" \
            -body "${{ github.event.inputs.body || 'Firebase Functions ê¸°ë°˜ FCM ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤!' }}" \
            -date "$(date +%Y-%m-%d)" \
            -url "https://geeksbaek.github.io/daily-feed/"
          
          echo "âœ… FCM í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë°œì†¡ ì™„ë£Œ!"